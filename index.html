<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Interactive Color Theory Lab — p5.js</title>
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.3/lib/p5.min.js"></script>
<style>
  :root{
    --bg:#0b0e14; --card:#101826; --muted:#9fb0c6; --accent:#00d4ff; --stroke:#223048;
  }
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(1200px 600px at 10% -10%, #14223b 0%, transparent 60%), var(--bg);color:#e8eef7;font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial}
  header{padding:22px 20px 10px; text-align:center}
  h1{margin:0;font-size:clamp(24px,3.4vw,36px);background:linear-gradient(90deg,#00d4ff,#9a6bff);-webkit-background-clip:text;background-clip:text;color:transparent}
  .sub{color:var(--muted)}
  .wrap{max-width:1200px;margin:0 auto;padding:16px 20px 36px;}
  .panel{background:linear-gradient(180deg,#101826, #0f1724);border:1px solid var(--stroke);border-radius:14px;box-shadow:0 12px 40px rgba(0,0,0,.45);padding:16px}
  .grid{display:grid;gap:16px;grid-template-columns:1.2fr 1fr}
  .controls{display:grid;gap:10px;grid-template-columns:repeat(2,minmax(0,1fr))}
  label{font-size:13px;color:#cfe0ff}
  select,input[type="range"],button{width:100%;background:#0e1522;border:1px solid var(--stroke);color:#e8eef7;padding:10px;border-radius:10px}
  button{cursor:pointer}
  .row{display:grid;gap:12px;grid-template-columns:repeat(4,minmax(0,1fr))}
  .swatch{height:56px;border-radius:12px;border:1px solid var(--stroke);box-shadow:inset 0 -24px 48px rgba(0,0,0,.25)}
  .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;font-size:12px;color:var(--muted)}
  .area{display:grid;gap:16px;grid-template-columns:1fr 1fr}
  .card{background:#0e1624;border:1px solid var(--stroke);border-radius:14px;padding:10px;}
  .card h3{margin:6px 6px 10px;font-size:14px;color:#d7e7ff}
  canvas{display:block;width:100% !important;height:auto !important;border-radius:12px;border:1px solid var(--stroke)}
  .tip{margin-top:10px;color:var(--muted);font-size:13px}
  .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;background:#0e1522;border:1px solid var(--stroke);padding:.1em .45em;border-radius:6px}
  .footer{margin-top:18px;display:flex;gap:10px;flex-wrap:wrap}
</style>
</head>
<body>
  <header>
    <h1>Interactive Color Theory Lab</h1>
    <div class="sub">Drag the wheel, explore harmony guides, pick exact hues, and export clean PNGs.</div>
  </header>

  <div class="wrap">
    <div class="grid">
      <div class="panel">
        <div id="wheel-container"></div>
        <div class="legend">
          <div><span class="kbd">Drag</span> handle to set base hue</div>
          <div>• Harmony lines show relationships</div>
          <div>• Click swatches to copy hex</div>
        </div>
        <div id="palette" class="row" style="margin-top:10px"></div>
      </div>

      <div class="panel">
        <div class="controls">
          <div>
            <label>Harmony</label>
            <select id="harmony">
              <option value="mono">Monochromatic</option>
              <option value="complementary">Complementary</option>
              <option value="split">Split Complementary</option>
              <option value="analogous">Analogous</option>
              <option value="triad" selected>Triadic</option>
              <option value="tetradRect">Tetradic (Rectangle)</option>
              <option value="tetradSquare">Tetradic (Square)</option>
            </select>
          </div>
          <div>
            <label>Hue (°)</label>
            <input id="hueNum" type="number" min="0" max="359.9" step="0.1" value="200" />
          </div>
          <div>
            <label>Segments on Wheel</label>
            <input id="segments" type="range" min="180" max="1440" step="30" value="720" />
          </div>
          <div>
            <label>Snap to (°)</label>
            <input id="snap" type="number" min="0" max="45" step="0.1" value="1" />
          </div>
          <div>
            <label>Swatch Saturation (%)</label>
            <input id="swS" type="range" min="0" max="100" value="80" />
          </div>
          <div>
            <label>Swatch Lightness (%)</label>
            <input id="swL" type="range" min="0" max="100" value="55" />
          </div>
        </div>

        <div class="footer">
          <button id="exportPalette">Export Palette PNG</button>
          <button id="exportWheel">Export Wheel + Guides PNG</button>
        </div>
        <div class="tip">Tip: Use the Hue input for precise values (0.1°). “Snap” rounds drag movements to that increment.</div>
      </div>
    </div>
  </div>

<script>
/**********************
 * Color Theory Engine *
 **********************/
const SCHEMES = {
  mono:      [0],
  complementary: [0, 180],
  split:     [0, 150, 210],
  analogous: [-30, 0, 30],
  triad:     [0, 120, 240],
  tetradRect:[0, 60, 180, 240],
  tetradSquare:[0, 90, 180, 270],
};

function hslToRgb(h, s, l){ s/=100; l/=100; const k=n=>(n+h/30)%12, a=s*Math.min(l,1-l);
  const f=n=>l-a*Math.max(-1,Math.min(k(n)-3,Math.min(9-k(n),1)));
  return [Math.round(255*f(0)), Math.round(255*f(8)), Math.round(255*f(4))]; }
function toHex(r,g,b){ return "#"+[r,g,b].map(v=>v.toString(16).padStart(2,'0')).join('').toUpperCase(); }

/****************
 * App State     *
 ****************/
let wheelSketch;
let baseHue = 200.0;     // degrees (float for precision)
let segments = 720;      // high-detail wheel
let harmony = 'triad';
let snapDeg = 1.0;       // rounding for drag input
let swatchS = 80;        // palette saturation
let swatchL = 55;        // palette lightness
let radius, cx, cy;      // wheel geometry
let dragging = false;

function computePalette(){
  const hs = SCHEMES[harmony].map(a => (baseHue + a + 360) % 360);
  return hs.map(h => toHex(...hslToRgb(h, swatchS, swatchL)));
}

function updatePaletteUI(){
  const cont = document.getElementById('palette');
  cont.innerHTML = '';
  const palette = computePalette();
  palette.forEach(hex=>{
    const d = document.createElement('div');
    d.className='swatch';
    d.style.background = hex; d.title = hex;
    d.onclick = async ()=>{ await navigator.clipboard.writeText(hex); d.style.outline='2px solid var(--accent)'; setTimeout(()=>d.style.outline='none', 600); };
    cont.appendChild(d);
  });
}

/****************
 * Wheel (p5)    *
 ****************/
const wheelCanvas = new p5(p => {
  const W=560, H=560;
  p.setup = () => {
    const holder = document.getElementById('wheel-container');
    const c = p.createCanvas(W, H); c.parent(holder); p.pixelDensity(1);
    radius = Math.min(W, H)*0.46; cx=W/2; cy=H/2;
    drawWheel();
  };

  function drawWheel(){
    p.clear(); p.noStroke();
    // High-resolution conic wheel
    for(let i=0;i<segments;i++){
      const a0 = p.TWO_PI * (i/segments);
      const a1 = p.TWO_PI * ((i+1)/segments);
      const deg = (360 * i/segments);
      const col = hslToRgb(deg, 100, 50);
      p.fill(...col); p.arc(cx, cy, radius*2, radius*2, a0, a1, p.PIE);
    }
    // inner hole for readability
    p.fill(16,22,34); p.circle(cx, cy, radius*0.52);

    // Harmony guides
    const pts = SCHEMES[harmony].map(a => {
      const d = (baseHue + a) % 360; const rad = p.radians(d-90);
      return {x: cx + Math.cos(rad)*radius*0.9, y: cy + Math.sin(rad)*radius*0.9, d};
    });
    p.stroke(0,0,0,120); p.strokeWeight(3); p.noFill();
    p.beginShape(); pts.forEach(pt=>p.vertex(pt.x, pt.y)); if(pts.length>2) p.endShape(p.CLOSE); else p.endShape();
    p.stroke(0,212,255,220); p.strokeWeight(2);
    p.beginShape(); pts.forEach(pt=>p.vertex(pt.x, pt.y)); if(pts.length>2) p.endShape(p.CLOSE); else p.endShape();

    // Handle at base hue
    const rad = p.radians(baseHue-90);
    const hx = cx + Math.cos(rad)*radius*0.9;
    const hy = cy + Math.sin(rad)*radius*0.9;
    p.noStroke(); p.fill(255); p.circle(hx, hy, 14); p.fill(0); p.circle(hx, hy, 6);

    // Readout
    const baseHex = toHex(...hslToRgb(baseHue, swatchS, swatchL));
    p.noStroke(); p.fill(232,238,247); p.textAlign(p.CENTER, p.CENTER); p.textSize(14);
    p.text(`Hue: ${baseHue.toFixed(1)}° • ${harmony} • ${baseHex}`, cx, H-18);

    // Sync numeric input
    const hueNum = document.getElementById('hueNum');
    if(document.activeElement !== hueNum){ hueNum.value = baseHue.toFixed(1); }
  }

  function setHueFromMouse(){
    const dx = p.mouseX - cx; const dy = p.mouseY - cy;
    let h = (p.degrees(Math.atan2(dy, dx)) + 90 + 360) % 360;
    if(snapDeg>0){ h = Math.round(h / snapDeg) * snapDeg; }
    baseHue = ((h % 360) + 360) % 360;
  }

  p.mousePressed = () => {
    const d = p.dist(p.mouseX, p.mouseY, cx, cy);
    if (d > radius*0.7 && d < radius*1.05){ dragging = true; setHueFromMouse(); updatePaletteUI(); drawWheel(); }
  };
  p.mouseDragged = () => { if(dragging){ setHueFromMouse(); updatePaletteUI(); drawWheel(); } };
  p.mouseReleased = () => { dragging=false; };

  // expose
  wheelSketch = { redraw: drawWheel };
});

/****************
 * Export PNGs   *
 ****************/
function exportPalettePNG(){
  const items = computePalette();
  const cellW=220, cellH=120, pad=24, cols=Math.min(items.length, 4), rows=Math.ceil(items.length/4);
  const W = pad*2 + cols*cellW, H = pad*2 + rows*cellH + 40;
  const can = document.createElement('canvas'); can.width=W; can.height=H; const ctx = can.getContext('2d');
  // bg
  ctx.fillStyle = '#0b0e14'; ctx.fillRect(0,0,W,H);
  // title
  ctx.font='18px Inter,Arial'; ctx.fillStyle='#e8eef7'; ctx.textAlign='left'; ctx.fillText(`Palette — ${harmony} @ ${baseHue.toFixed(1)}°  (S:${swatchS} L:${swatchL})`, pad, pad+4);
  // cells
  items.forEach((hex, i)=>{
    const x = pad + (i%4)*cellW; const y = pad+40 + Math.floor(i/4)*cellH;
    // swatch
    ctx.fillStyle = hex; ctx.strokeStyle = '#223048'; ctx.lineWidth=2;
    ctx.fillRect(x, y, cellW-16, cellH-46); ctx.strokeRect(x, y, cellW-16, cellH-46);
    // label area
    ctx.fillStyle = '#101826'; ctx.fillRect(x, y+cellH-46, cellW-16, 46);
    ctx.strokeStyle = '#223048'; ctx.strokeRect(x, y+cellH-46, cellW-16, 46);
    // text
    ctx.fillStyle = '#9fb0c6'; ctx.font='12px Inter,Arial'; ctx.fillText(hex, x+10, y+cellH-20);
  });
  triggerDownload(can, `palette_${harmony}_${Math.round(baseHue*10)}.png`);
}

function exportWheelPNG(){
  const size=900; const pad=30; const R = size*0.38; const cx = size/2, cy = size/2;
  const can = document.createElement('canvas'); can.width=size; can.height=size; const ctx=can.getContext('2d');
  // bg
  ctx.fillStyle='#0b0e14'; ctx.fillRect(0,0,size,size);
  // conic approximation
  for(let i=0;i<segments;i++){
    const a0 = 2*Math.PI*(i/segments); const a1 = 2*Math.PI*((i+1)/segments);
    const deg = 360 * i/segments; const [r,g,b]=hslToRgb(deg,100,50);
    ctx.fillStyle=`rgb(${r},${g},${b})`;
    ctx.beginPath(); ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,R,a0,a1,false); ctx.closePath(); ctx.fill();
  }
  // inner hole
  ctx.fillStyle='#101826'; ctx.beginPath(); ctx.arc(cx,cy,R*0.52,0,Math.PI*2); ctx.fill();
  // guides
  const angles = SCHEMES[harmony].map(a => (baseHue + a) % 360);
  ctx.lineWidth=6; ctx.strokeStyle='rgba(0,0,0,0.45)';
  ctx.beginPath(); angles.forEach((d,i)=>{ const rad=(d-90)*Math.PI/180; const x=cx+Math.cos(rad)*R*0.9; const y=cy+Math.sin(rad)*R*0.9; (i?ctx.lineTo:ctx.moveTo).call(ctx,x,y); }); if(angles.length>2) ctx.closePath(); ctx.stroke();
  ctx.lineWidth=3; ctx.strokeStyle='rgba(0,212,255,0.85)';
  ctx.beginPath(); angles.forEach((d,i)=>{ const rad=(d-90)*Math.PI/180; const x=cx+Math.cos(rad)*R*0.9; const y=cy+Math.sin(rad)*R*0.9; (i?ctx.lineTo:ctx.moveTo).call(ctx,x,y); }); if(angles.length>2) ctx.closePath(); ctx.stroke();
  // nodes
  angles.forEach(d=>{ const rad=(d-90)*Math.PI/180; const x=cx+Math.cos(rad)*R*0.9; const y=cy+Math.sin(rad)*R*0.9; ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(x,y,9,0,Math.PI*2); ctx.fill(); ctx.fillStyle='#000'; ctx.beginPath(); ctx.arc(x,y,4,0,Math.PI*2); ctx.fill(); });
  // footer text
  ctx.fillStyle='#e8eef7'; ctx.font='20px Inter,Arial'; ctx.textAlign='center';
  const baseHex = toHex(...hslToRgb(baseHue, swatchS, swatchL));
  ctx.fillText(`Hue ${baseHue.toFixed(1)}°  •  ${harmony}  •  ${baseHex}`, cx, size-pad);
  triggerDownload(can, `wheel_${harmony}_${Math.round(baseHue*10)}.png`);
}

function triggerDownload(canvas, filename){ const a=document.createElement('a'); a.download=filename; a.href=canvas.toDataURL('image/png'); a.click(); }

/****************
 * UI Wiring     *
 ****************/
function initUI(){
  document.getElementById('harmony').value = harmony;
  document.getElementById('harmony').onchange = (e)=>{ harmony = e.target.value; wheelSketch.redraw(); updatePaletteUI(); };

  document.getElementById('segments').value = segments;
  document.getElementById('segments').oninput = (e)=>{ segments = Number(e.target.value); wheelSketch.redraw(); };

  document.getElementById('hueNum').value = baseHue.toFixed(1);
  document.getElementById('hueNum').oninput = (e)=>{ const v=parseFloat(e.target.value||'0'); baseHue=((v%360)+360)%360; wheelSketch.redraw(); updatePaletteUI(); };

  document.getElementById('snap').value = snapDeg;
  document.getElementById('snap').oninput = (e)=>{ snapDeg = Math.max(0, parseFloat(e.target.value||'0')); };

  document.getElementById('swS').value = swatchS; document.getElementById('swL').value = swatchL;
  document.getElementById('swS').oninput = (e)=>{ swatchS = Number(e.target.value); updatePaletteUI(); wheelSketch.redraw(); };
  document.getElementById('swL').oninput = (e)=>{ swatchL = Number(e.target.value); updatePaletteUI(); wheelSketch.redraw(); };

  document.getElementById('exportPalette').onclick = exportPalettePNG;
  document.getElementById('exportWheel').onclick = exportWheelPNG;

  updatePaletteUI();
}

initUI();
</script>
</body>
</html>
